<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KaleidoLAB | Client Galleries</title>
  <style>
    :root{ --bg:#0b0b0c; --card:#141417; --muted:#9aa0a6; --pri:#e1e1e6; --brand:#ff2a2a; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--pri);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:#000 url('./logo.png.jpg') center/contain no-repeat;border:1px solid #222}
    .title{font-weight:800;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:.95rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:18px}
    .card{background:var(--card);border:1px solid #222;border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:4/3;background:#0f1013 center/cover no-repeat}
    .card .ctr{padding:14px;display:flex;flex-direction:column;gap:6px}
    .badge{font-size:.75rem;color:#cbd5e1}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border:1px solid #2a2a2f;border-radius:12px;background:#18181b;cursor:pointer}
    .btn:hover{border-color:#3a3a40}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .search{margin:18px 0 6px;display:flex;gap:8px}
    .search input{flex:1;background:#121216;border:1px solid #23232a;border-radius:12px;color:#fff;padding:12px}
    .pill{padding:6px 10px;background:#121216;border:1px solid #222;border-radius:999px;color:#cbd5e1;font-size:.8rem}
    .footer{margin:24px 0;color:#838b95;font-size:.9rem}
    .hidden{display:none}
    .gallery{margin-top:18px}
    .gallery .head{display:flex;align-items:center;gap:10px}
    .pinlock{margin-top:12px;display:flex;gap:8px}
    .pinlock input{width:160px;background:#111;border:1px solid #222;border-radius:10px;color:#fff;padding:10px;letter-spacing:4px;text-align:center}
    .media{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:16px}
    .media a{display:block;border:1px solid #222;border-radius:14px;overflow:hidden}
    .media img{width:100%;height:auto;display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"></div>
      <div>
        <div class="title">KaleidoLAB — Client Galleries</div>
        <div class="sub">Installable PWA to deliver photos</div>
      </div>
    </header>

    <div class="search">
      <input id="q" placeholder="Search…" />
      <span class="pill" id="count">0</span>
    </div>

    <div id="list" class="grid"></div>

    <section id="viewer" class="gallery hidden"></section>

    <div class="footer">© KaleidoLAB — Free app to share client photos</div>
  </div>

<script>
const GALLERIES = [
  { id:'retrato', title:'Portrait (last photo)', cover:'./2025-09-15-12-09-42-content.jpg', pin:'2024', files:[{type:'image', url:'./2025-09-15-12-09-42-content.jpg', name:'Portrait.jpg'}]},
  { id:'negativo', title:'Gallery (negative photo)', cover:'./2025-09-15-12-09-33-content.jpg', pin:'1357', files:[{type:'image', url:'./2025-09-15-12-09-33-content.jpg', name:'Negative.jpg'}]},
  { id:'cianotipia', title:'Cyanotype (the resulting photo)', cover:'./2025-09-15-12-09-37-content.jpg', pin:'2468', files:[{type:'image', url:'./2025-09-15-12-09-37-content.jpg', name:'Cyanotype.jpg'}]}
];

const listEl=document.getElementById('list');
const viewer=document.getElementById('viewer');
const search=document.getElementById('q');
const count=document.getElementById('count');

function renderList(filter=''){
  const q=filter.trim().toLowerCase();
  const items=GALLERIES.filter(g=>g.title.toLowerCase().includes(q));
  count.textContent= items.length+' galleries';
  listEl.innerHTML= items.map(g=>`<article class="card"><a href="#/g/${g.id}"><div class="thumb" style="background-image:url('${g.cover}')"></div></a><div class="ctr"><div class="row"><strong>${g.title}</strong><span class="badge">PIN</span></div><a class="btn" href="#/g/${g.id}">Open</a></div></article>`).join('');
}

function renderGallery(id){
  const g=GALLERIES.find(x=>x.id===id);
  if(!g){location.hash='';return}
  const stored=sessionStorage.getItem('pin:'+id)||'';
  const unlocked=stored===g.pin;
  viewer.classList.remove('hidden');
  listEl.classList.add('hidden');
  search.parentElement.classList.add('hidden');
  viewer.innerHTML = `<div class="head"><a class="btn" href="#">Back</a><h2>${g.title}</h2><span class="pill">${g.files.length} files</span></div>${!unlocked?`<div class="pinlock"><input id="pin" maxlength="8" placeholder="PIN" inputmode="numeric" /><button class="btn" id="unlockBtn">Unlock</button></div><p>Enter the PIN to view this gallery.</p>`:`<div class="media">${g.files.map(f=>`<a href="${f.url}" download><img src="${f.url}" alt="${g.title}"></a>`).join('')}</div>`}`;
  viewer.querySelector('a.btn').addEventListener('click', e=>{e.preventDefault();location.hash='';});
  document.getElementById('unlockBtn')?.addEventListener('click', ()=>{
    const pin=document.getElementById('pin').value.trim();
    if(pin===g.pin){sessionStorage.setItem('pin:'+id,pin); renderGallery(id);} else {alert('Incorrect PIN');}
  });
}

function route(){
  const h=location.hash;
  if(h.startsWith('#/g/')){ renderGallery(h.split('#/g/')[1]); } else { viewer.classList.add('hidden'); listEl.classList.remove('hidden'); search.parentElement.classList.remove('hidden'); renderList(search.value); }
}

search.addEventListener('input', ()=>renderList(search.value));
window.addEventListener('hashchange', route);
renderList();
route();
</script>
</body>
</html>
